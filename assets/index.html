<html>
  <head>
    <title>pg_eventserv</title>
  </head>
  <style type="text/css">
    body {margin:0;padding:0;font-family:sans-serif;}
    h1 {padding:1em;margin:0;width:auto;background:#0167B4;color:white;}
    #content {padding:1em 2em;line-height:1.3em;}
    h2 {font-size:120%;}
    .status {font-weight:bold;margin:1em 0;}
    .info {background:#f0f0f0;padding:1em;margin:1em 0;border-radius:5px;}
  </style>
<body>
  <h1>pg_eventserv</h1>
  <div id="content">
    <h2>PostgreSQL to Redis Event Bridge</h2>
    <div class="info">
      <p>This service listens to PostgreSQL NOTIFY events and publishes them to Redis channels.</p>
      <p><strong>Available channels:</strong> {{ .Channels }}</p>
      <p><strong>Redis server:</strong> {{ .RedisAddr }}</p>
    </div>
    
    <h2>Start Channel Listener</h2>
    <p>Enter a channel name to start listening to PostgreSQL NOTIFY events and publishing them to Redis:</p>
    <p><input type="text" id="channel" placeholder="channel_name">&nbsp;<input type="button" value="Start Listening" onClick="startListener()"></p>
    
    <div id="channels">
    </div>
    
    <h2>How to Subscribe</h2>
    <div class="info">
      <p>To receive events, subscribe to the Redis channel using any Redis client:</p>
      <pre>SUBSCRIBE channel_name</pre>
      <p>Example using redis-cli:</p>
      <pre>redis-cli subscribe channel_name</pre>
    </div>
  </div>
  <script>
    function startListener() {
      var channel = document.getElementById("channel").value;
      if (!channel) {
        alert("Please enter a channel name");
        return;
      }
      
      var url = "{{ .BaseURL }}/listen/" + channel;
      var channelsDiv = document.getElementById("channels");
      var div = document.createElement("div");
      div.className = "status";
      channelsDiv.append(div);
      
      fetch(url)
        .then(response => response.text())
        .then(data => {
          div.innerHTML = `✓ ${data}`;
        })
        .catch(error => {
          div.innerHTML = `✗ Error: ${error}`;
        });
    }
  </script>
</div>
</body>
</html>